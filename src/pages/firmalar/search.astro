---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { companies } from '../../data/companies';
---

<BaseLayout title="Firma Arama">
  <main style="max-width:1000px;margin:2rem auto;padding:1rem;">
    <h1>Firma Rehberi / Ara</h1>
    <p>Filtreleyerek firma bulun. Örnek: sektör seçip şehir/yaz ile arama.</p>

    <div style="display:flex;gap:0.75rem;flex-wrap:wrap;margin:1rem 0">
      <label style="display:flex;gap:0.5rem;align-items:center">
        Sektör
        <select id="sector" style="padding:0.4rem">
          <option value="">Tümü</option>
          {Array.from(new Set(companies.map(c => c.sector))).map(s => (
            <option value={s}>{s}</option>
          ))}
        </select>
      </label>

      <label style="display:flex;gap:0.5rem;align-items:center">
        Konum
        <input id="location" placeholder="Örn: Bursa veya Türkiye" style="padding:0.4rem" />
      </label>

      <button id="clear" style="padding:0.4rem 0.8rem">Temizle</button>
    </div>

    <div id="results"></div>

    <script type="module">
      // Client-side filter: companies data serialized into HTML
      const companies = JSON.parse(decodeURIComponent(`%5B${encodeURIComponent(JSON.stringify(companies)).slice(1,-1)}%5D`));

      const sectorEl = document.getElementById('sector');
      const locationEl = document.getElementById('location');
      const resultsEl = document.getElementById('results');
      const clearBtn = document.getElementById('clear');

      function render(list) {
        if(!list.length) {
          resultsEl.innerHTML = '<p>Sonuç bulunamadı.</p>';
          return;
        }
        resultsEl.innerHTML = '';
        list.forEach(c => {
          const card = document.createElement('div');
          card.style.border = '1px solid #eee';
          card.style.padding = '12px';
          card.style.marginBottom = '10px';
          card.style.borderRadius = '8px';
          card.innerHTML = `
            <div style="display:flex;gap:12px;align-items:center">
              <img src="${c.heroIcon||'/images/icons/teknoloji-yazilim.svg'}" width="56" height="56" style="border-radius:8px;object-fit:cover" alt="ikon"/>
              <div>
                <a href="/firmalar/${c.sector}/${c.slug}" style="font-weight:700;color:#0d6efd;text-decoration:none">${c.title}</a>
                <div style="color:#555">${c.description||''}</div>
                <div style="font-size:0.9rem;color:#777">${c.location||''} — ${c.sector}</div>
              </div>
            </div>`;
          resultsEl.appendChild(card);
        });
      }

      function applyFilters() {
        const sector = sectorEl.value.trim();
        const loc = locationEl.value.trim().toLowerCase();
        let filtered = companies.slice();
        if(sector) filtered = filtered.filter(c => c.sector === sector);
        if(loc) filtered = filtered.filter(c => (c.location||'').toLowerCase().includes(loc));
        render(filtered);
      }

      sectorEl.addEventListener('change', applyFilters);
      locationEl.addEventListener('input', applyFilters);
      clearBtn.addEventListener('click', () => { sectorEl.value=''; locationEl.value=''; applyFilters(); });

      // initial
      render(companies);
    </script>
  </main>
</BaseLayout>
