---
import BaseLayout from "@layouts/BaseLayout.astro";

const pageTitle = "Trafik Sigortası Hesaplama";
const pageDescription = "Zorunlu trafik sigortası primini hesaplayın. İl, araç türü, kullanım şekli ve basamak tarifisine göre trafik sigortası fiyatı.";
const canonicalURL = "https://meetwork.com.tr/hesaplama/trafik-sigortasi";
---

<BaseLayout title={pageTitle} description={pageDescription} canonical={canonicalURL}>
  <main class="container py-5">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
        <li class="breadcrumb-item"><a href="/hesaplama">Hesaplama</a></li>
        <li class="breadcrumb-item"><a href="/hesap/sigorta">Sigorta</a></li>
        <li class="breadcrumb-item active" aria-current="page">{pageTitle}</li>
      </ol>
    </nav>

    <section class="text-center mb-5">
      <h1 class="display-5 fw-bold text-primary mb-3">{pageTitle}</h1>
      <p class="lead text-muted mb-4">{pageDescription}</p>
    </section>

    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <h2 class="h4 text-primary mb-4">Zorunlu Trafik Sigortası Hesaplama Aracı</h2>
            
            <form id="calcForm">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">Tarife Dönemi</label>
                  <select id="tarifeDonemi" class="form-select" required>
                    <option value="">Seçiniz</option>
                    <option value="kasim-2025" selected>Kasım 2025</option>
                    <option value="ekim-2025">Ekim 2025</option>
                    <option value="eylul-2025">Eylül 2025</option>
                    <option value="agustos-2025">Ağustos 2025</option>
                    <option value="temmuz-2025">Temmuz 2025</option>
                    <option value="haziran-2025">Haziran 2025</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">İl</label>
                  <select id="il" class="form-select" required>
                    <option value="">Seçiniz</option>
                    <option value="istanbul">İstanbul</option>
                    <option value="ankara">Ankara</option>
                    <option value="izmir">İzmir</option>
                    <option value="antalya">Antalya</option>
                    <option value="adana">Adana</option>
                    <option value="konya">Konya</option>
                    <option value="bursa">Bursa</option>
                    <option value="kayseri">Kayseri</option>
                    <option value="trabzon">Trabzon</option>
                    <option value="samsun">Samsun</option>
                    <option value="erzurum">Erzurum</option>
                    <option value="diyarbakir">Diyarbakır</option>
                    <option value="malatya">Malatya</option>
                    <option value="van">Van</option>
                    <option value="mus">Muş</option>
                    <option value="agri">Ağrı</option>
                    <option value="erzincan">Erzincan</option>
                    <option value="bayburt">Bayburt</option>
                    <option value="gumushane">Gümüşhane</option>
                    <option value="artvin">Artvin</option>
                    <option value="rize">Rize</option>
                    <option value="kars">Kars</option>
                    <option value="ardahan">Ardahan</option>
                    <option value="igdir">Iğdır</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">Araç Türü</label>
                  <select id="aracTuru" class="form-select" required>
                    <option value="">Seçiniz</option>
                    <option value="otomobil">Otomobil</option>
                    <option value="taksi">Taksi</option>
                    <option value="minibus">Minibüs (Sürücü Dahil 10-17 Koltuk)</option>
                    <option value="otobus-18-30">Otobüs (Sürücü Dahil 18-30 Koltuk)</option>
                    <option value="otobus-31-ustu">Otobüs (Sürücü Dahil 31 ve Üzeri Koltuk)</option>
                    <option value="kamyonet">Kamyonet</option>
                    <option value="kamyon">Kamyon</option>
                    <option value="is-makinesi">İş Makinesi</option>
                    <option value="traktor">Traktör</option>
                    <option value="romork">Römork</option>
                    <option value="motosiklet">Motosiklet ve Yük Motosikleti</option>
                    <option value="tanker">Tanker</option>
                    <option value="cekici">Çekici</option>
                    <option value="ozel-amacli">Özel Amaçlı Taşıt</option>
                    <option value="tarim-makinesi">Tarım Makinesi</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">Kullanım Türü</label>
                  <select id="kullanimTuru" class="form-select" required>
                    <option value="">Seçiniz</option>
                    <option value="ozel" selected>Özel</option>
                    <option value="tuzel">Tüzel</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label fw-bold">Mevcut Basamak</label>
                  <select id="basamak" class="form-select" required>
                    <option value="">Seçiniz</option>
                    <option value="0">0. Basamak (3+ Hasar - %200 Zam)</option>
                    <option value="1">1. Basamak (Son 3 Yıl Hasar - %135 Zam)</option>
                    <option value="2">2. Basamak (Son 2 Yıl Hasar - %90 Zam)</option>
                    <option value="3">3. Basamak (1. Yıl Hasar - %45 Zam)</option>
                    <option value="4">4. Basamak (İlk Kez - %10 Zam)</option>
                    <option value="5" selected>5. Basamak (1 Yıl Hasarsız - %5 İndirim)</option>
                    <option value="6">6. Basamak (2 Yıl Hasarsız - %20 İndirim)</option>
                    <option value="7">7. Basamak (3 Yıl Hasarsız - %40 İndirim)</option>
                    <option value="8">8. Basamak (5+ Yıl Hasarsız - %50 İndirim)</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" id="elektrikli">
                    <label class="form-check-label fw-bold" for="elektrikli">
                      %100 Elektrikli Mi?
                    </label>
                    <small class="form-text text-muted">%10 ek indirim uygulanır</small>
                  </div>
                </div>
              </div>

              <div class="alert alert-info mb-3">
                <small><strong>Basamak Tarifesi:</strong> Sürücünün hasar geçmişine göre indirim/zam uygulanır. Hasarsız geçen her yıl basamak yükselir.</small>
              </div>

              <div class="d-flex gap-2 mb-3">
                <button type="button" id="btnHesapla" class="btn btn-primary">Hesapla</button>
                <button type="reset" id="btnSifirla" class="btn btn-outline-secondary">Sıfırla</button>
              </div>
            </form>

            <div id="sonuc" class="mt-4 alert alert-success" style="display:none;">
              <h5 class="fw-bold text-success mb-3">Trafik Sigortası Hesaplama Sonucu</h5>
              <div id="sonucText"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="row mt-5">
      <div class="col-lg-8 mx-auto">
        <h2 class="h3 text-primary mb-3">Trafik Sigortası Hakkında Bilgiler</h2>
        <div class="alert alert-light">
          <strong>Zorunlu Trafik Sigortası:</strong> Motorlu taşıtların Karayolları Trafik Kanunu kapsamında zorunlu olarak yaptırılması gereken sigortadır.<br><br>
          
          <strong>Kapsamı:</strong> Üçüncü şahıslara verilecek zararları karşılar<br>
          <strong>Geçerlilik:</strong> 1 yıl, her yıl yenilenmesi zorunlu<br>
          <strong>Yaptırmama Cezası:</strong> Trafik cezası ve araç muayenesi yapılmaz<br><br>
          
          <strong>Basamak Tarifesi:</strong><br>
          • <strong>0. Basamak:</strong> 3+ hasar (%200 zam)<br>
          • <strong>1-3. Basamak:</strong> Hasar geçmişi (%45-135 zam)<br>
          • <strong>4. Basamak:</strong> İlk defa (%10 zam)<br>
          • <strong>5. Basamak:</strong> 1 yıl hasarsız (%5 indirim)<br>
          • <strong>6. Basamak:</strong> 2 yıl hasarsız (%20 indirim)<br>
          • <strong>7. Basamak:</strong> 3 yıl hasarsız (%40 indirim)<br>
          • <strong>8. Basamak:</strong> 5+ yıl hasarsız (%50 indirim)<br><br>
          
          <strong>Özel İndirimler:</strong><br>
          • <strong>Elektrikli Araç:</strong> %10 ek indirim<br>
          • <strong>Ticari Araçlar:</strong> Bazı basamaklarda ek indirimler<br><br>
          
          <strong>Zorunlu Sigortalar:</strong> Trafik sigortası, Kasko değil<br>
          <strong>Teminat Sınırı:</strong> Kişi başı ve toplam zarar limitleri vardır
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<script>
  const btnHesapla = document.getElementById('btnHesapla');
  const btnSifirla = document.getElementById('btnSifirla');
  const sonuc = document.getElementById('sonuc');
  const sonucText = document.getElementById('sonucText');


  // Araç türüne göre temel primler (2025 Kasım - TL)
  const temelPrimler = {
    'otomobil': 1200,
    'taksi': 1800,
    'minibus': 2100,
    'otobus-18-30': 2800,
    'otobus-31-ustu': 3500,
    'kamyonet': 1400,
    'kamyon': 2200,
    'is-makinesi': 1600,
    'traktor': 800,
    'romork': 600,
    'motosiklet': 900,
    'tanker': 2400,
    'cekici': 2600,
    'ozel-amacli': 1800,
    'tarim-makinesi': 500
  };

  // İl katsayıları (risk faktörüne göre)
  const ilKatsayilari = {
    'istanbul': 1.3,
    'ankara': 1.2,
    'izmir': 1.25,
    'antalya': 1.1,
    'adana': 1.05,
    'konya': 1.0,
    'bursa': 1.15,
    'kayseri': 1.0,
    'trabzon': 1.1,
    'samsun': 1.0,
    'erzurum': 0.9,
    'diyarbakir': 1.0,
    'malatya': 0.95,
    'van': 0.9,
    'mus': 0.85,
    'agri': 0.8,
    'erzincan': 0.9,
    'bayburt': 0.8,
    'gumushane': 0.9,
    'artvin': 0.85,
    'rize': 1.0,
    'kars': 0.8,
    'ardahan': 0.75,
    'igdir': 0.8
  };

  // Basamak katsayıları
  function getBasamakKatsayisi(basamak, aracTuru) {
    const katsayilar = {
      0: 3.0,   // %200 zam (2.0 + 1.0)
      1: 2.35,  // %135 zam
      2: 1.90,  // %90 zam
      3: 1.45,  // %45 zam
      4: 1.10,  // %10 zam
      5: 0.95,  // %5 indirim
      6: 0.80,  // %20 indirim
      7: 0.60,  // %40 indirim
      8: 0.50   // %50 indirim
    };

    let katsayi = katsayilar[basamak] || 1.0;

    // Ticari araçlar için ek indirimler (basamak 5-7)
    const ticariAraclar = ['taksi', 'minibus', 'otobus-18-30', 'otobus-31-ustu', 'kamyon', 'cekici'];
    if (ticariAraclar.includes(aracTuru) && basamak >= 5 && basamak <= 7) {
      if (basamak === 5) katsayi *= 0.9; // %10 ek indirim
      else if (basamak === 6) katsayi *= 0.8; // %20 ek indirim
      else if (basamak === 7) katsayi *= 0.7; // %30 ek indirim
    }

    return katsayi;
  }

  function getBasamakAciklama(basamak) {
    const aciklamalar = {
      0: '3+ hasar geçmişi',
      1: 'Son 3 yıl hasar',
      2: 'Son 2 yıl hasar',
      3: '1. yıl hasar',
      4: 'İlk defa',
      5: '1 yıl hasarsız',
      6: '2 yıl hasarsız',
      7: '3 yıl hasarsız',
      8: '5+ yıl hasarsız'
    };
    return aciklamalar[basamak] || 'Bilinmeyen';
  }

  function getBasamakEtki(basamak) {
    const etkiler = {
      0: '+%200 Zam',
      1: '+%135 Zam',
      2: '+%90 Zam',
      3: '+%45 Zam',
      4: '+%10 Zam',
      5: '-%5 İndirim',
      6: '-%20 İndirim',
      7: '-%40 İndirim',
      8: '-%50 İndirim'
    };
    return etkiler[basamak] || 'Normal';
  }

  btnHesapla.addEventListener('click', () => {
    const tarifeDonemi = document.getElementById('tarifeDonemi').value;
    const il = document.getElementById('il').value;
    const aracTuru = document.getElementById('aracTuru').value;
    const kullanimTuru = document.getElementById('kullanimTuru').value;
    const basamak = parseInt(document.getElementById('basamak').value);
    const elektrikli = document.getElementById('elektrikli').checked;

    if (!tarifeDonemi || !il || !aracTuru || !kullanimTuru || basamak === 0 && document.getElementById('basamak').value === '') {
      alert('Lütfen tüm alanları doldurun');
      return;
    }

    // Temel prim
    const temelPrim = temelPrimler[aracTuru] || 1000;
    
    // İl katsayısı
    const ilKatsayisi = ilKatsayilari[il] || 1.0;
    
    // Basamak katsayısı
    const basamakKatsayisi = getBasamakKatsayisi(basamak, aracTuru);
    
    // Kullanım türü etkisi (tüzel %5 daha pahalı)
    const kullanimKatsayisi = kullanimTuru === 'tuzel' ? 1.05 : 1.0;
    
    // Elektrikli araç indirimi
    const elektrikliKatsayisi = elektrikli ? 0.9 : 1.0;
    
    // Dönem etkisi (enflasyon vs.)
    let donemKatsayisi = 1.0;
    if (tarifeDonemi === 'ekim-2025') donemKatsayisi = 1.02;
    else if (tarifeDonemi === 'eylul-2025') donemKatsayisi = 1.04;
    else if (tarifeDonemi === 'agustos-2025') donemKatsayisi = 1.06;
    else if (tarifeDonemi === 'temmuz-2025') donemKatsayisi = 1.08;
    else if (tarifeDonemi === 'haziran-2025') donemKatsayisi = 1.10;

    // Son hesaplama
    const hesaplananPrim = temelPrim * ilKatsayisi * basamakKatsayisi * kullanimKatsayisi * elektrikliKatsayisi * donemKatsayisi;

    // Min-max aralığı (farklı şirketler için)
    const minPrim = hesaplananPrim * 0.85;
    const maxPrim = hesaplananPrim * 1.15;

    // Aylık taksit hesabı (12 taksit)
    const aylikTaksit = hesaplananPrim / 12;

    // Karşılaştırma için örnek primler
    const ornekPrimler = {
      enDusuk: minPrim * 0.9,
      orta: hesaplananPrim,
      yuksek: maxPrim * 1.1
    };

    // Basamak geçmişi simülasyonu
    const birYilSonra = Math.min(basamak + 1, 8);
    const ikiYilSonra = Math.min(basamak + 2, 8);
    
    sonucText.innerHTML = `
      <div class="row mb-3">
        <div class="col-md-6">
          <strong>Araç Türü:</strong><br>
          <span class="h6">${aracTuru === 'otomobil' ? 'Otomobil' : aracTuru === 'taksi' ? 'Taksi' : aracTuru.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
        </div>
        <div class="col-md-6">
          <strong>İl:</strong><br>
          <span class="h6">${il.charAt(0).toUpperCase() + il.slice(1)}</span>
        </div>
      </div>
      
      <div class="row mb-3">
        <div class="col-md-6">
          <strong>Kullanım Türü:</strong><br>
          <span class="h6">${kullanimTuru === 'ozel' ? 'Özel' : 'Tüzel'}</span>
        </div>
        <div class="col-md-6">
          <strong>Elektrikli Araç:</strong><br>
          <span class="h6">${elektrikli ? 'Evet (%10 indirim)' : 'Hayır'}</span>
        </div>
      </div>

      <hr class="my-3">
      
      <div class="row">
        <div class="col-md-6">
          <strong>Mevcut Basamak:</strong><br>
          <span class="h6 text-primary">${basamak}. Basamak (${getBasamakAciklama(basamak)})</span>
        </div>
        <div class="col-md-6">
          <strong>Etki:</strong><br>
          <span class="h6 ${basamak >= 5 ? 'text-success' : 'text-danger'}">${getBasamakEtki(basamak)}</span>
        </div>
      </div>

      <hr class="my-3">
      
      <div class="row">
        <div class="col-md-12">
          <strong>HESAPLANAN YILLIK PRIM:</strong><br>
          <span class="h3 text-success">${hesaplananPrim.toLocaleString('tr-TR', {minimumFractionDigits: 0})} TL</span>
        </div>
      </div>

      <hr class="my-3">
      
      <div class="row">
        <div class="col-md-6">
          <strong>Fiyat Aralığı:</strong><br>
          <span class="h6">${minPrim.toLocaleString('tr-TR', {minimumFractionDigits: 0')} - ${maxPrim.toLocaleString('tr-TR', {minimumFractionDigits: 0})} TL</span>
        </div>
        <div class="col-md-6">
          <strong>Aylık Taksit:</strong><br>
          <span class="h6 text-info">${aylikTaksit.toLocaleString('tr-TR', {minimumFractionDigits: 0')} TL x 12 taksit</span>
        </div>
      </div>

      <hr class="my-3">
      
      <div class="row">
        <div class="col-md-4">
          <div class="card border-success">
            <div class="card-body p-3">
              <h6 class="text-success">En Uygun</h6>
              <div class="h6">${ornekPrimler.enDusuk.toLocaleString('tr-TR', {minimumFractionDigits: 0')} TL</div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-primary">
            <div class="card-body p-3">
              <h6 class="text-primary">Ortalama</h6>
              <div class="h6">${ornekPrimler.orta.toLocaleString('tr-TR', {minimumFractionDigits: 0')} TL</div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-warning">
            <div class="card-body p-3">
              <h6 class="text-warning">Yüksek</h6>
              <div class="h6">${ornekPrimler.yuksek.toLocaleString('tr-TR', {minimumFractionDigits: 0')} TL</div>
            </div>
          </div>
        </div>
      </div>

      <hr class="my-3">
      
      <div class="row">
        <div class="col-md-6">
          <strong>1 Yıl Sonra Basamak:</strong><br>
          <span class="h6 text-success">${birYilSonra}. Basamak (${getBasamakEtki(birYilSonra)})</span>
        </div>
        <div class="col-md-6">
          <strong>2 Yıl Sonra Basamak:</strong><br>
          <span class="h6 text-success">${ikiYilSonra}. Basamak (${getBasamakEtki(ikiYilSonra)})</span>
        </div>
      </div>

      <div class="alert alert-warning mt-3">
        <small><strong>Not:</strong> Hesaplanan prim temsili değerdir. Gerçek prim sigorta şirketine göre değişebilir. Elektrikli araçlara %10 ek indirim uygulanır.</small>
      </div>
    `;
    sonuc.style.display = 'block';
  });

  btnSifirla.addEventListener('click', () => {
    sonuc.style.display = 'none';
  });
</script>
</BaseLayout>